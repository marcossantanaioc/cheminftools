chemtools
================

<!-- WARNING: THIS FILE WAS AUTOGENERATED! DO NOT EDIT! -->

## How to use

Chemtools offer a collection of cheminformatics scripts for daily tasks.
Currently supported tasks include:

    1 - Standardization of chemical structures

    2 - Calculation of molecular descriptors

    3 - Filtering datasets using predefined alerts (e.g. PAINS, Dundee, Glaxo)

# Standardization

A dataset of molecules can be standardize in just 1 line of code!

``` python
data = pd.read_csv('../data/Lipophilicity.csv')
```

# Sanitizing

The
[\[`MolCleaner`\](https://marcossantanaioc.github.io/chemtools/sanitizer.html#molcleaner)]('sanitizer.ipynb')
class performs sanitization tasks following the steps implemented on
[chembl_structure_pipeline](https://github.com/chembl/ChEMBL_Structure_Pipeline)

        1. Standardize unknown stereochemistry (Handled by the RDKit Mol file parser)
            i) Fix wiggly bonds on sp3 carbons - sets atoms and bonds marked as unknown stereo to no stereo
            ii) Fix wiggly bonds on double bonds – set double bond to crossed bond
        2. Clears S Group data from the mol file
        3. Kekulize the structure
        4. Remove H atoms (See the page on explicit Hs for more details)
        5. Normalization:
            Fix hypervalent nitro groups
            Fix KO to K+ O- and NaO to Na+ O- (Also add Li+ to this)
            Correct amides with N=COH
            Standardise sulphoxides to charge separated form
            Standardize diazonium N (atom :2 here: [*:1]-[N;X2:2]#[N;X1:3]>>[*:1]) to N+
            Ensure quaternary N is charged
            Ensure trivalent O ([*:1]=[O;X2;v3;+0:2]-[#6:3]) is charged
            Ensure trivalent S ([O:1]=[S;D2;+0:2]-[#6:3]) is charged
            Ensure halogen with no neighbors ([F,Cl,Br,I;X0;+0:1]) is charged
        6. The molecule is neutralized, if possible. See the page on neutralization rules for more details.
        7. Remove stereo from tartrate to simplify salt matching
        8. Normalise (straighten) triple bonds and allenes
        
        
        
        The curation steps in ChEMBL structure pipeline were augmented with additional steps to identify duplicated entries
        9. Find stereo centers
        10. Generate inchi keys
        11. Find duplicated SMILES. If the same SMILES is present multiple times, two outcomes are possible.
            i. The same compound (e.g. same ID and same SMILES)
            ii. Isomers with different SMILES, IDs and/or activities
            
            In case i), the compounds are merged by taking the median values of all numeric columns in the dataframe. 
            For case ii), the compounds are further classified as 'to merge' or 'to keep' depending on the activity values.
                a) Compounds are considered for mergining (to merge) if the difference in acvitities is less than 1log unit.
                b) Compounds are considered for keeping as individual entries (to keep) if the difference in activities is larger than 1log unit. In this case, the user can
                select which compound to keep - the one with highest or lowest activity.

``` python
processed_data = MolCleaner.from_df(data, smiles_col='smiles', act_col='exp', id_col='CMPD_CHEMBLID')
```

      2%|▏         | 90/4200 [00:00<00:25, 158.22it/s][19:31:14] Tautomer enumeration stopped at 304 tautomers: max transforms reached
      3%|▎         | 140/4200 [00:01<00:43, 93.55it/s][19:31:15] Tautomer enumeration stopped at 714 tautomers: max transforms reached
      5%|▌         | 213/4200 [00:02<00:40, 98.36it/s][19:31:15] Tautomer enumeration stopped at 318 tautomers: max transforms reached
    [19:31:15] Tautomer enumeration stopped at 400 tautomers: max transforms reached
     20%|█▉        | 833/4200 [00:04<00:19, 173.61it/s][19:31:18] Tautomer enumeration stopped at 304 tautomers: max transforms reached
     25%|██▌       | 1063/4200 [00:05<00:15, 208.82it/s][19:31:19] Tautomer enumeration stopped at 338 tautomers: max transforms reached
     34%|███▍      | 1426/4200 [00:08<00:32, 84.66it/s] [19:31:21] Tautomer enumeration stopped at 1000 tautomers: max tautomers reached
     37%|███▋      | 1570/4200 [00:08<00:19, 137.70it/s][19:31:22] Tautomer enumeration stopped at 157 tautomers: max transforms reached
    [19:31:22] Tautomer enumeration stopped at 429 tautomers: max transforms reached
     51%|█████     | 2142/4200 [00:10<00:07, 280.52it/s][19:31:24] Tautomer enumeration stopped at 570 tautomers: max transforms reached
     63%|██████▎   | 2654/4200 [00:12<00:07, 213.35it/s][19:31:26] Tautomer enumeration stopped at 381 tautomers: max transforms reached
     66%|██████▌   | 2780/4200 [00:13<00:07, 196.66it/s][19:31:26] Tautomer enumeration stopped at 274 tautomers: max transforms reached
     67%|██████▋   | 2802/4200 [00:13<00:10, 134.26it/s][19:31:28] Tautomer enumeration stopped at 1000 tautomers: max tautomers reached
     83%|████████▎ | 3478/4200 [00:17<00:04, 179.74it/s][19:31:30] Tautomer enumeration stopped at 196 tautomers: max transforms reached
     84%|████████▍ | 3532/4200 [00:17<00:03, 190.39it/s][19:31:31] Tautomer enumeration stopped at 157 tautomers: max transforms reached
    [19:31:32] Tautomer enumeration stopped at 1000 tautomers: max tautomers reached
    [19:31:32] Tautomer enumeration stopped at 213 tautomers: max transforms reached
    100%|██████████| 4200/4200 [00:20<00:00, 207.52it/s]
    /notebooks/chemtools/chemtools/tools/sanitizer.py:334: FutureWarning: Behavior when concatenating bool-dtype and numeric-dtype arrays is deprecated; in a future version these will cast to object dtype (instead of coercing bools to numeric values). To retain the old behavior, explicitly cast bool-dtype arrays to numeric dtype.
      return pd.concat([no_duplicates, *processed_duplicates],axis=0)

# Filtering

The
[\[`MolFiltering`\](https://marcossantanaioc.github.io/chemtools/filtering.html#molfiltering)]('filtering.ipynb')
class is responsible for removing compounds that match defined
substructural alerts, including PAINS and rules defined by different
organizations, such as GSK and University of Dundee.

``` python
clean_dataset, alerts_dataset = MolFiltering.from_df(processed_data, smiles_col='processed_smiles')
```

      3%|▎         | 131/4175 [00:02<01:08, 59.34it/s][19:33:08] Tautomer enumeration stopped at 361 tautomers: max transforms reached
      5%|▍         | 202/4175 [00:04<01:12, 54.98it/s][19:33:10] Tautomer enumeration stopped at 733 tautomers: max transforms reached
      9%|▊         | 357/4175 [00:08<01:37, 38.96it/s][19:33:14] Tautomer enumeration stopped at 628 tautomers: max transforms reached
     21%|██        | 856/4175 [00:21<01:43, 31.96it/s][19:33:27] Tautomer enumeration stopped at 304 tautomers: max transforms reached
     28%|██▊       | 1159/4175 [00:28<00:43, 69.23it/s][19:33:34] Tautomer enumeration stopped at 338 tautomers: max transforms reached
     33%|███▎      | 1381/4175 [00:33<01:25, 32.53it/s][19:33:40] Tautomer enumeration stopped at 1000 tautomers: max tautomers reached
     37%|███▋      | 1551/4175 [00:38<00:44, 58.82it/s][19:33:45] Tautomer enumeration stopped at 1000 tautomers: max tautomers reached
     43%|████▎     | 1797/4175 [00:44<00:35, 66.51it/s][19:33:50] Tautomer enumeration stopped at 429 tautomers: max transforms reached
     51%|█████     | 2130/4175 [00:51<00:45, 44.53it/s][19:33:57] Tautomer enumeration stopped at 834 tautomers: max transforms reached
     63%|██████▎   | 2638/4175 [01:03<00:27, 56.66it/s][19:34:09] Tautomer enumeration stopped at 384 tautomers: max transforms reached
     66%|██████▌   | 2764/4175 [01:06<00:25, 54.33it/s][19:34:12] Tautomer enumeration stopped at 274 tautomers: max transforms reached
     69%|██████▊   | 2860/4175 [01:09<00:27, 47.28it/s][19:34:15] Tautomer enumeration stopped at 953 tautomers: max transforms reached
     84%|████████▎ | 3490/4175 [01:23<00:10, 66.00it/s][19:34:29] Tautomer enumeration stopped at 190 tautomers: max transforms reached
     85%|████████▌ | 3553/4175 [01:25<00:11, 54.64it/s][19:34:32] Tautomer enumeration stopped at 1000 tautomers: max tautomers reached
     94%|█████████▎| 3906/4175 [01:34<00:04, 57.99it/s][19:34:40] Tautomer enumeration stopped at 213 tautomers: max transforms reached
    100%|█████████▉| 4166/4175 [01:39<00:00, 61.64it/s][19:34:45] Tautomer enumeration stopped at 160 tautomers: max transforms reached
    100%|██████████| 4175/4175 [01:40<00:00, 41.74it/s]

    Total number of flagged molecules = 85
    Most common flag = R18 Quaternary C, Cl, I, P or S

``` python
alerts_dataset.set_index('processed_smiles')['Alert_rule_set']
```

    processed_smiles
    Cc1cccc(CC(NC(=O)c2cc(C(C)(C)C)nn2C)C(=O)NCC#N)c1                   Glaxo
    COc1ccc(N2CCN(C(=O)C3CCCCC3C(=O)NCC#N)CC2)cc1                       Glaxo
    c1ccc(-c2cc(NCCCCCCCCNc3cc(-c4ccccc4)nc4ccccc34)c3ccccc3n2)cc1      Glaxo
    [O-][S+](c1ccccc1)c1ccc2nnnn2n1                                     Glaxo
    CC1=N[SH](=O)(c2cccc(-c3ccc(C)cc3)c2)NC1=O                          Glaxo
                                                                        ...  
    CC[C@H](NC(=O)c1c([S+](C)[O-])c(-c2ccccc2)nc2c(F)cccc12)c1ccccc1    Glaxo
    CCCN1CCN(c2ccc(C(=O)NC3(C(=O)NCC#N)CCCCC3)cc2)CC1                   Glaxo
    N#CCNC(=O)C1CCCCC1C(=O)N1CCN(c2ccccc2)CC1                           Glaxo
    NNC(=O)c1ccncc1                                                     Glaxo
    CC[C@H](NC(=O)c1c([S+](C)[O-])c(-c2ccccc2)nc2ccccc12)c1ccccc1       Glaxo
    Name: Alert_rule_set, Length: 87, dtype: object

#### Quinone

``` python
mol = Chem.MolFromSmiles('COC1/C=C\OC2(C)Oc3c(C)c(O)c4c(c3C2=O)C(=O)C=C(NC(=O)/C(C)=C\C=C/C(C)C(O)C(C)C(O)C(C)C(OC(C)=O)C1C)C4=O')
mol.GetSubstructMatches(Chem.MolFromSmarts('O=C1[#6]~[#6]C(=O)[#6]~[#6]1'))
mol
```

![](index_files/figure-gfm/cell-6-output-1.png)

#### Cynamide

``` python
mol1 = Chem.MolFromSmiles('Cc1cccc(C[C@H](NC(=O)c2cc(C(C)(C)C)nn2C)C(=O)NCC#N)c1')
mol1.GetSubstructMatches(Chem.MolFromSmarts('N[CH2]C#N'))
mol1
```

![](index_files/figure-gfm/cell-7-output-1.png)

#### R18 Quaternary C, Cl, I, P or S

``` python
mol = Chem.MolFromSmiles('CC[C@H](NC(=O)c1c([S+](C)[O-])c(-c2ccccc2)nc2ccccc12)c1ccccc1')
mol.GetSubstructMatches(Chem.MolFromSmarts('[C+,Cl+,I+,P+,S+]'))
mol
```

![](index_files/figure-gfm/cell-8-output-1.png)

# Featurization

The
[\[`MolFeaturizer`\](https://marcossantanaioc.github.io/chemtools/featurizer.html#molfeaturizer)]('featurizer.ipynb')
class converts SMILES into molecular descriptors. The current version
supports Morgan fingerprints, Atom Pairs, Torsion Fingerprints, RDKit
fingerprints and 200 constitutional descriptors, and MACCS keys.

``` python
fingerprinter = MolFeaturizer('morgan')
```

``` python
X = fingerprinter.process_smiles_list(clean_dataset['processed_smiles'].values)
```

    Calculating fingerprints: 100%|██████████| 4090/4090 [00:01<00:00, 2752.95it/s]

``` python
X[0:5]
```

    array([[0, 0, 0, ..., 0, 0, 0],
           [0, 0, 0, ..., 1, 0, 0],
           [0, 1, 0, ..., 0, 0, 0],
           [0, 0, 0, ..., 0, 0, 0],
           [0, 0, 1, ..., 0, 0, 0]], dtype=uint8)
