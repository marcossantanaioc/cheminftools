<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" lang="en" xml:lang="en"><head>

<meta charset="utf-8">
<meta name="generator" content="quarto-1.1.189">

<meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=yes">


<title>chemtools - Standardizer</title>
<style>
code{white-space: pre-wrap;}
span.smallcaps{font-variant: small-caps;}
div.columns{display: flex; gap: min(4vw, 1.5em);}
div.column{flex: auto; overflow-x: auto;}
div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
ul.task-list{list-style: none;}
ul.task-list li input[type="checkbox"] {
  width: 0.8em;
  margin: 0 0.8em 0.2em -1.6em;
  vertical-align: middle;
}
</style>


<script src="site_libs/quarto-nav/quarto-nav.js"></script>
<script src="site_libs/quarto-nav/headroom.min.js"></script>
<script src="site_libs/clipboard/clipboard.min.js"></script>
<script src="site_libs/quarto-search/autocomplete.umd.js"></script>
<script src="site_libs/quarto-search/fuse.min.js"></script>
<script src="site_libs/quarto-search/quarto-search.js"></script>
<meta name="quarto:offset" content="./">
<script src="site_libs/quarto-html/quarto.js"></script>
<script src="site_libs/quarto-html/popper.min.js"></script>
<script src="site_libs/quarto-html/tippy.umd.min.js"></script>
<script src="site_libs/quarto-html/anchor.min.js"></script>
<link href="site_libs/quarto-html/tippy.css" rel="stylesheet">
<link href="site_libs/quarto-html/quarto-syntax-highlighting.css" rel="stylesheet" id="quarto-text-highlighting-styles">
<script src="site_libs/bootstrap/bootstrap.min.js"></script>
<link href="site_libs/bootstrap/bootstrap-icons.css" rel="stylesheet">
<link href="site_libs/bootstrap/bootstrap.min.css" rel="stylesheet" id="quarto-bootstrap" data-mode="light">
<script id="quarto-search-options" type="application/json">{
  "location": "navbar",
  "copy-button": false,
  "collapse-after": 3,
  "panel-placement": "end",
  "type": "overlay",
  "limit": 20,
  "language": {
    "search-no-results-text": "No results",
    "search-matching-documents-text": "matching documents",
    "search-copy-link-title": "Copy link to search",
    "search-hide-matches-text": "Hide additional matches",
    "search-more-match-text": "more match in this document",
    "search-more-matches-text": "more matches in this document",
    "search-clear-button-title": "Clear",
    "search-detached-cancel-button-title": "Cancel",
    "search-submit-button-title": "Submit"
  }
}</script>


<link rel="stylesheet" href="styles.css">
<meta property="og:title" content="chemtools - Standardizer">
<meta property="og:description" content="source">
<meta property="og:site-name" content="chemtools">
<meta name="twitter:title" content="chemtools - Standardizer">
<meta name="twitter:description" content="source">
<meta name="twitter:card" content="summary">
</head>

<body class="nav-sidebar floating nav-fixed">

<div id="quarto-search-results"></div>
  <header id="quarto-header" class="headroom fixed-top">
    <nav class="navbar navbar-expand-lg navbar-dark ">
      <div class="navbar-container container-fluid">
      <div class="navbar-brand-container">
    <a class="navbar-brand" href="./index.html">
    <span class="navbar-title">chemtools</span>
    </a>
  </div>
          <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbarCollapse" aria-controls="navbarCollapse" aria-expanded="false" aria-label="Toggle navigation" onclick="if (window.quartoToggleHeadroom) { window.quartoToggleHeadroom(); }">
  <span class="navbar-toggler-icon"></span>
</button>
          <div class="collapse navbar-collapse" id="navbarCollapse">
            <ul class="navbar-nav navbar-nav-scroll ms-auto">
  <li class="nav-item compact">
    <a class="nav-link" href="https://github.com/marcossantanaioc/chemtools"><i class="bi bi-github" role="img">
</i> 
 </a>
  </li>  
</ul>
              <div id="quarto-search" class="" title="Search"></div>
          </div> <!-- /navcollapse -->
      </div> <!-- /container-fluid -->
    </nav>
  <nav class="quarto-secondary-nav" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar" aria-controls="quarto-sidebar" aria-expanded="false" aria-label="Toggle sidebar navigation" onclick="if (window.quartoToggleHeadroom) { window.quartoToggleHeadroom(); }">
    <div class="container-fluid d-flex justify-content-between">
      <h1 class="quarto-secondary-nav-title">Standardizer</h1>
      <button type="button" class="quarto-btn-toggle btn" aria-label="Show secondary navigation">
        <i class="bi bi-chevron-right"></i>
      </button>
    </div>
  </nav>
</header>
<!-- content -->
<div id="quarto-content" class="quarto-container page-columns page-rows-contents page-layout-article page-navbar">
<!-- sidebar -->
  <nav id="quarto-sidebar" class="sidebar collapse sidebar-navigation floating overflow-auto">
    <div class="sidebar-menu-container"> 
    <ul class="list-unstyled mt-1">
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./index.html" class="sidebar-item-text sidebar-link">chemtools</a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./tools.featurizer.html" class="sidebar-item-text sidebar-link">Featurizer</a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./tools.filtering.html" class="sidebar-item-text sidebar-link">Filtering</a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./tools.sanitizer.html" class="sidebar-item-text sidebar-link active">Standardizer</a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./utils.html" class="sidebar-item-text sidebar-link">Utils</a>
  </div>
</li>
    </ul>
    </div>
</nav>
<!-- margin-sidebar -->
    <div id="quarto-margin-sidebar" class="sidebar margin-sidebar">
        <nav id="TOC" role="doc-toc" class="toc-active">
    <h2 id="toc-title">On this page</h2>
   
  <ul>
  <li><a href="#helper-functions" id="toc-helper-functions" class="nav-link active" data-scroll-target="#helper-functions">Helper functions</a>
  <ul>
  <li><a href="#find_inchikey_duplicates" id="toc-find_inchikey_duplicates" class="nav-link" data-scroll-target="#find_inchikey_duplicates">find_inchikey_duplicates</a></li>
  <li><a href="#build_inchi_dict" id="toc-build_inchi_dict" class="nav-link" data-scroll-target="#build_inchi_dict">build_inchi_dict</a></li>
  <li><a href="#mol_to_inchi" id="toc-mol_to_inchi" class="nav-link" data-scroll-target="#mol_to_inchi">mol_to_inchi</a></li>
  <li><a href="#process_duplicates" id="toc-process_duplicates" class="nav-link" data-scroll-target="#process_duplicates">process_duplicates</a></li>
  <li><a href="#remove_racemic" id="toc-remove_racemic" class="nav-link" data-scroll-target="#remove_racemic">remove_racemic</a></li>
  <li><a href="#get_stereo_info" id="toc-get_stereo_info" class="nav-link" data-scroll-target="#get_stereo_info">get_stereo_info</a></li>
  <li><a href="#normalize_mol" id="toc-normalize_mol" class="nav-link" data-scroll-target="#normalize_mol">normalize_mol</a></li>
  <li><a href="#remove_unwanted" id="toc-remove_unwanted" class="nav-link" data-scroll-target="#remove_unwanted">remove_unwanted</a></li>
  <li><a href="#add_nitrogen_charges" id="toc-add_nitrogen_charges" class="nav-link" data-scroll-target="#add_nitrogen_charges">add_nitrogen_charges</a></li>
  </ul></li>
  <li><a href="#molcleaner" id="toc-molcleaner" class="nav-link" data-scroll-target="#molcleaner">MolCleaner</a>
  <ul>
  <li><a href="#molcleaner-1" id="toc-molcleaner-1" class="nav-link" data-scroll-target="#molcleaner-1">MolCleaner</a></li>
  </ul></li>
  </ul>
<div class="toc-actions"><div><i class="bi bi-github"></i></div><div class="action-links"><p><a href="https://github.com/marcossantanaioc/chemtools/issues/new" class="toc-action">Report an issue</a></p></div></div></nav>
    </div>
<!-- main -->
<main class="content" id="quarto-document-content">

<header id="title-block-header" class="quarto-title-block default">
<div class="quarto-title">
<h1 class="title d-none d-lg-block">Standardizer</h1>
</div>



<div class="quarto-title-meta">

    
    
  </div>
  

</header>

<!-- WARNING: THIS FILE WAS AUTOGENERATED! DO NOT EDIT! -->
<section id="helper-functions" class="level2">
<h2 class="anchored" data-anchor-id="helper-functions">Helper functions</h2>
<hr>
<p><a href="https://github.com/marcossantanaioc/chemtools/blob/master/chemtools/tools/sanitizer.py#L46" target="_blank" style="float:right; font-size:smaller">source</a></p>
<section id="find_inchikey_duplicates" class="level3">
<h3 class="anchored" data-anchor-id="find_inchikey_duplicates">find_inchikey_duplicates</h3>
<blockquote class="blockquote">
<pre><code> find_inchikey_duplicates (mol_list)</code></pre>
</blockquote>
<hr>
<p><a href="https://github.com/marcossantanaioc/chemtools/blob/master/chemtools/tools/sanitizer.py#L40" target="_blank" style="float:right; font-size:smaller">source</a></p>
</section>
<section id="build_inchi_dict" class="level3">
<h3 class="anchored" data-anchor-id="build_inchi_dict">build_inchi_dict</h3>
<blockquote class="blockquote">
<pre><code> build_inchi_dict (smiles_list)</code></pre>
</blockquote>
<hr>
<p><a href="https://github.com/marcossantanaioc/chemtools/blob/master/chemtools/tools/sanitizer.py#L34" target="_blank" style="float:right; font-size:smaller">source</a></p>
</section>
<section id="mol_to_inchi" class="level3">
<h3 class="anchored" data-anchor-id="mol_to_inchi">mol_to_inchi</h3>
<blockquote class="blockquote">
<pre><code> mol_to_inchi (mol)</code></pre>
</blockquote>
<p>Converts a rdchem.Mol object into InCHI keys</p>
<hr>
<p><a href="https://github.com/marcossantanaioc/chemtools/blob/master/chemtools/tools/sanitizer.py#L219" target="_blank" style="float:right; font-size:smaller">source</a></p>
</section>
<section id="process_duplicates" class="level3">
<h3 class="anchored" data-anchor-id="process_duplicates">process_duplicates</h3>
<blockquote class="blockquote">
<pre><code> process_duplicates (data, smiles_col:str, act_col:str, id_col:str,
                     cols_to_check:list=None, stereo_col:str='Stereo',
                     keep:str='first')</code></pre>
</blockquote>
<p>Removes duplicated records from a dataset</p>
<p>The removal of duplicates is based on the stereochemical information provided by dotmatics, SMILES, ids and bioactivity records. Records sharing the same SMILES, IDs and/or bioactivity information, are merged by taking the median bioactivity value. This step is used to clean records with multiple measurements.</p>
<p>Duplicated records with different IDs and/or bioactivities are treated separately because they usually represent different isomers. For these compounds, the duplicated records are first split into <code>to_merge</code> and <code>to_keep</code> portions, indicating the different compounds should be considered to be kept in the dataset or merged into the same record, respectively. Duplicated records are considered for keeping, if the difference between max and min bioactivity is larger or equal to 1.0 (e.g.&nbsp;1 pIC50 unit); else the records are considered for merging.</p>
<p>Compounds marked for keeping filtered by the <code>keep</code> parameter. If <code>keep == True</code>, the duplicate with highest bioactivity value is kept; else the duplicate with lowest bioactivity is kept. Compounds marked for merging are combined by taking the median of all columns.</p>
<p>Arguments:</p>
<pre><code>    data : pd.DataFrame
        A pandas Dataframe with molecular data for sanitization.

    smiles_col : str
        The name of the column with SMILES for each molecule.

    id_col : str
        The name of the column with IDs for each molecule.

    act_col : str
        The name of the column with bioactivity data for each molecule. 

    cols_to_check : list
        A list of columns to use as reference to find duplicates.

Returns:
    recombined_data : `pandas.DataFrame`

        A sanitized version of the `data` without duplicates.</code></pre>
<hr>
<p><a href="https://github.com/marcossantanaioc/chemtools/blob/master/chemtools/tools/sanitizer.py#L182" target="_blank" style="float:right; font-size:smaller">source</a></p>
</section>
<section id="remove_racemic" class="level3">
<h3 class="anchored" data-anchor-id="remove_racemic">remove_racemic</h3>
<blockquote class="blockquote">
<pre><code> remove_racemic (df, smiles_col, stereo_col)</code></pre>
</blockquote>
<p>Remove records containing Mixture or Racemic information in the stereochemistry column from Dotmatics Compounds are only removed if the SMILES are duplicated and single isomer is also present.</p>
<p>Arguments:</p>
<pre><code>df : `pandas.DataFrame`

    A pandas dataframe.

smiles_col : str

    A string representing the column of `df` with SMILES.

stereo_col : str

    A string representing the column of `df` with stereochemistry information for each molecule.          </code></pre>
<p>Returns: A list of columns with modifier values</p>
<hr>
<p><a href="https://github.com/marcossantanaioc/chemtools/blob/master/chemtools/tools/sanitizer.py#L170" target="_blank" style="float:right; font-size:smaller">source</a></p>
</section>
<section id="get_stereo_info" class="level3">
<h3 class="anchored" data-anchor-id="get_stereo_info">get_stereo_info</h3>
<blockquote class="blockquote">
<pre><code> get_stereo_info (mol)</code></pre>
</blockquote>
<hr>
<p><a href="https://github.com/marcossantanaioc/chemtools/blob/master/chemtools/tools/sanitizer.py#L123" target="_blank" style="float:right; font-size:smaller">source</a></p>
</section>
<section id="normalize_mol" class="level3">
<h3 class="anchored" data-anchor-id="normalize_mol">normalize_mol</h3>
<blockquote class="blockquote">
<pre><code> normalize_mol (mol)</code></pre>
</blockquote>
<p>Standardize a rdchem.Mol object.</p>
<p>Arguments:</p>
<pre><code>mol : rdchem.Mol</code></pre>
<p>Returns: mol : rdchem.Mol A standardized version of <code>mol</code>.</p>
<p>Steps:</p>
<ol type="1">
<li><p>Convert a SMILES to a rdchem.Mol object or return <code>mol</code> if it’s already a rdchem.Mol</p></li>
<li><p>Kekulize, check valencies, set aromaticity, conjugation and hybridization, remove hydrogens, disconnect metal atoms, normalize the molecule and reionize it.</p></li>
<li><p>Get parent fragment if multiple molecules (e.g.&nbsp;mixtures) are present</p></li>
<li><p>Neutralize parent molecule</p></li>
</ol>
<hr>
<p><a href="https://github.com/marcossantanaioc/chemtools/blob/master/chemtools/tools/sanitizer.py#L98" target="_blank" style="float:right; font-size:smaller">source</a></p>
</section>
<section id="remove_unwanted" class="level3">
<h3 class="anchored" data-anchor-id="remove_unwanted">remove_unwanted</h3>
<blockquote class="blockquote">
<pre><code> remove_unwanted (mol)</code></pre>
</blockquote>
<p>Remove molecules with unwanted elements (check the _unwanted definition) and isotopes</p>
<hr>
<p><a href="https://github.com/marcossantanaioc/chemtools/blob/master/chemtools/tools/sanitizer.py#L69" target="_blank" style="float:right; font-size:smaller">source</a></p>
</section>
<section id="add_nitrogen_charges" class="level3">
<h3 class="anchored" data-anchor-id="add_nitrogen_charges">add_nitrogen_charges</h3>
<blockquote class="blockquote">
<pre><code> add_nitrogen_charges (mol)</code></pre>
</blockquote>
<p>Fixes charge on nitrogen if its valence raises an Exception on RDKit See the discussion on: https://github.com/rdkit/rdkit/issues/3310</p>
</section>
</section>
<section id="molcleaner" class="level2">
<h2 class="anchored" data-anchor-id="molcleaner">MolCleaner</h2>
<hr>
<p><a href="https://github.com/marcossantanaioc/chemtools/blob/master/chemtools/tools/sanitizer.py#L346" target="_blank" style="float:right; font-size:smaller">source</a></p>
<section id="molcleaner-1" class="level3">
<h3 class="anchored" data-anchor-id="molcleaner-1">MolCleaner</h3>
<blockquote class="blockquote">
<pre><code> MolCleaner ()</code></pre>
</blockquote>
<p>Sanitize a molecular dataset</p>
<p>Use static methods <code>MolCleaner.from_df or MolCleaner.from_csv</code> instead of accessing the class directly.</p>
<ol type="1">
<li>Standardize unknown stereochemistry (Handled by the RDKit Mol file parser)
<ol type="i">
<li>Fix wiggly bonds on sp3 carbons - sets atoms and bonds marked as unknown stereo to no stereo</li>
<li>Fix wiggly bonds on double bonds – set double bond to crossed bond</li>
</ol></li>
<li>Clears S Group data from the mol file</li>
<li>Kekulize the structure</li>
<li>Remove H atoms (See the page on explicit Hs for more details)</li>
<li>Normalization: Fix hypervalent nitro groups Fix KO to K+ O- and NaO to Na+ O- (Also add Li+ to this) Correct amides with N=COH Standardise sulphoxides to charge separated form Standardize diazonium N (atom :2 here: [*:1]-[N;X2:2]#[N;X1:3]&gt;&gt;[*:1]) to N+ Ensure quaternary N is charged Ensure trivalent O ([*:1]=[O;X2;v3;+0:2]-[#6:3]) is charged Ensure trivalent S ([O:1]=[S;D2;+0:2]-[#6:3]) is charged Ensure halogen with no neighbors ([F,Cl,Br,I;X0;+0:1]) is charged</li>
<li>The molecule is neutralized, if possible. See the page on neutralization rules for more details.</li>
<li>Remove stereo from tartrate to simplify salt matching</li>
<li>Normalise (straighten) triple bonds and allenes</li>
</ol>
<p>The curation steps in ChEMBL structure pipeline were augmented with additional steps to identify duplicated entries 9. Find stereo centers 10. Generate inchi keys 11. Find duplicated SMILES. If the same SMILES is present multiple times, two outcomes are possible. i. The same compound (e.g.&nbsp;same ID and same SMILES) ii. Isomers with different SMILES, IDs and/or activities</p>
<pre><code>In case i), the compounds are merged by taking the median values of all numeric columns in the dataframe. 
For case ii), the compounds are further classified as 'to merge' or 'to keep' depending on the activity values.
    a) Compounds are considered for mergining (to merge) if the difference in acvitities is less than 1log unit.
    b) Compounds are considered for keeping as individual entries (to keep) if the difference in activities is larger than 1log unit. In this case, the user can
    select which compound to keep - the one with highest or lowest activity.</code></pre>


</section>
</section>

</main> <!-- /main -->
<script id="quarto-html-after-body" type="application/javascript">
window.document.addEventListener("DOMContentLoaded", function (event) {
  const toggleBodyColorMode = (bsSheetEl) => {
    const mode = bsSheetEl.getAttribute("data-mode");
    const bodyEl = window.document.querySelector("body");
    if (mode === "dark") {
      bodyEl.classList.add("quarto-dark");
      bodyEl.classList.remove("quarto-light");
    } else {
      bodyEl.classList.add("quarto-light");
      bodyEl.classList.remove("quarto-dark");
    }
  }
  const toggleBodyColorPrimary = () => {
    const bsSheetEl = window.document.querySelector("link#quarto-bootstrap");
    if (bsSheetEl) {
      toggleBodyColorMode(bsSheetEl);
    }
  }
  toggleBodyColorPrimary();  
  const icon = "";
  const anchorJS = new window.AnchorJS();
  anchorJS.options = {
    placement: 'right',
    icon: icon
  };
  anchorJS.add('.anchored');
  const clipboard = new window.ClipboardJS('.code-copy-button', {
    target: function(trigger) {
      return trigger.previousElementSibling;
    }
  });
  clipboard.on('success', function(e) {
    // button target
    const button = e.trigger;
    // don't keep focus
    button.blur();
    // flash "checked"
    button.classList.add('code-copy-button-checked');
    var currentTitle = button.getAttribute("title");
    button.setAttribute("title", "Copied!");
    setTimeout(function() {
      button.setAttribute("title", currentTitle);
      button.classList.remove('code-copy-button-checked');
    }, 1000);
    // clear code selection
    e.clearSelection();
  });
  function tippyHover(el, contentFn) {
    const config = {
      allowHTML: true,
      content: contentFn,
      maxWidth: 500,
      delay: 100,
      arrow: false,
      appendTo: function(el) {
          return el.parentElement;
      },
      interactive: true,
      interactiveBorder: 10,
      theme: 'quarto',
      placement: 'bottom-start'
    };
    window.tippy(el, config); 
  }
  const noterefs = window.document.querySelectorAll('a[role="doc-noteref"]');
  for (var i=0; i<noterefs.length; i++) {
    const ref = noterefs[i];
    tippyHover(ref, function() {
      // use id or data attribute instead here
      let href = ref.getAttribute('data-footnote-href') || ref.getAttribute('href');
      try { href = new URL(href).hash; } catch {}
      const id = href.replace(/^#\/?/, "");
      const note = window.document.getElementById(id);
      return note.innerHTML;
    });
  }
  var bibliorefs = window.document.querySelectorAll('a[role="doc-biblioref"]');
  for (var i=0; i<bibliorefs.length; i++) {
    const ref = bibliorefs[i];
    const cites = ref.parentNode.getAttribute('data-cites').split(' ');
    tippyHover(ref, function() {
      var popup = window.document.createElement('div');
      cites.forEach(function(cite) {
        var citeDiv = window.document.createElement('div');
        citeDiv.classList.add('hanging-indent');
        citeDiv.classList.add('csl-entry');
        var biblioDiv = window.document.getElementById('ref-' + cite);
        if (biblioDiv) {
          citeDiv.innerHTML = biblioDiv.innerHTML;
        }
        popup.appendChild(citeDiv);
      });
      return popup.innerHTML;
    });
  }
});
</script>
</div> <!-- /content -->



</body></html>